const schedule = require('node-schedule');
const axios = require('axios');
const moment = require('moment-timezone');
const fs = require('fs');

module.exports.config = {
  name: 'autosent',
  version: '10000.0.0',
  hasPermssion: 0,
  credits: 'Belal x Gemini',
  description: 'THE RAMADAN EMPEROR - 20 UNIQUE FEATURES',
  commandCategory: 'system',
  usages: '[]',
  cooldowns: 3
};

// üíé ‡ß®‡ß™ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∞‡¶æ‡¶ú‡¶ï‡ßÄ‡¶Ø‡¶º ‡¶¨‡¶æ‡¶£‡ßÄ (‡¶Ü‡¶∞‡¶ì ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ)
const quotes = {
  0: ["‡¶®‡¶ø‡¶∏‡ßç‡¶§‡¶¨‡ßç‡¶ß ‡¶Æ‡¶ß‡ßç‡¶Ø‡¶∞‡¶æ‡¶§: ‡¶∞‡¶π‡¶Æ‡¶§‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶∂‡ßÅ‡¶∞‡ßÅ‡•§", "üìø ‡¶§‡¶∏‡¶¨‡¶ø‡¶π: '‡¶≤‡¶æ ‡¶á‡¶≤‡¶æ‡¶π‡¶æ ‡¶á‡¶≤‡ßç‡¶≤‡¶æ‡¶≤‡ßç‡¶≤‡¶æ‡¶π' ‡ßß‡ß¶‡ß¶ ‡¶¨‡¶æ‡¶∞‡•§"],
  3: ["‡¶¨‡¶∞‡¶ï‡¶§‡¶Æ‡ßü ‡¶∏‡ßá‡¶π‡¶∞‡¶ø‡¶∞ ‡¶∏‡¶Æ‡ßü‡•§ ‡¶¶‡¶∏‡ßç‡¶§‡¶∞‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∞‡¶ï‡¶§ ‡¶®‡¶ø‡¶®‡•§", "üçõ ‡¶∏‡ßá‡¶π‡¶∞‡¶ø ‡¶ñ‡¶æ‡¶ì‡ßü‡¶æ ‡¶¨‡¶∞‡¶ï‡¶§‡¶Æ‡ßü ‡¶∏‡ßÅ‡¶®‡ßç‡¶®‡¶§‡•§"],
  4: ["üö® ‡¶∏‡ßá‡¶π‡¶∞‡¶ø‡¶∞ ‡¶∂‡ßá‡¶∑ ‡¶∏‡¶Æ‡ßü! ‡¶™‡¶æ‡¶®‡¶æ‡¶π‡¶æ‡¶∞ ‡¶§‡ßç‡¶Ø‡¶æ‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", "üìø ‡¶§‡¶∏‡¶¨‡¶ø‡¶π: '‡¶Ü‡¶∏‡ßç‡¶§‡¶æ‡¶ó‡¶´‡¶ø‡¶∞‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π' ‡¶™‡¶æ‡¶† ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"],
  17: ["üïå ‡¶ó‡ßã‡¶≤‡ßç‡¶°‡ßá‡¶® ‡¶Ü‡¶ì‡ßü‡¶æ‡¶∞: ‡¶¶‡ßã‡ßü‡¶æ ‡¶ï‡¶¨‡ßÅ‡¶≤‡ßá‡¶∞ ‡¶∂‡ßç‡¶∞‡ßá‡¶∑‡ßç‡¶† ‡¶∏‡¶Æ‡ßü‡•§", "ü§≤ ‡¶á‡¶´‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶¨‡ßá‡¶∂‡¶ø ‡¶¨‡ßá‡¶∂‡¶ø ‡¶§‡¶ì‡¶¨‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"],
  18: ["üçπ ‡¶á‡¶´‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶§‡ßÉ‡¶™‡ßç‡¶§‡¶ø: ‡¶Æ‡¶æ‡¶≤‡¶ø‡¶ï‡ßá‡¶∞ ‡¶Ö‡¶∂‡ßá‡¶∑ ‡¶®‡ßá‡ßü‡¶æ‡¶Æ‡¶§‡•§", "üïå ‡¶Æ‡¶æ‡¶ó‡¶∞‡¶ø‡¶¨‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú ‡¶™‡ßú‡ßá ‡¶∂‡ßã‡¶ï‡¶∞‡¶ø‡ßü‡¶æ ‡¶ú‡¶æ‡¶®‡¶æ‡¶®‡•§"],
  20: ["‡¶§‡¶æ‡¶∞‡¶æ‡¶¨‡¶ø‡¶π‡¶∞ ‡¶™‡¶¨‡¶ø‡¶§‡ßç‡¶∞ ‡¶∏‡¶Æ‡ßü: ‡¶ï‡ßã‡¶∞‡¶Ü‡¶®‡ßá‡¶∞ ‡¶®‡ßÇ‡¶∞ ‡¶π‡ßÉ‡¶¶‡ßü‡ßá ‡¶®‡¶ø‡¶®‡•§", "üìñ ‡¶ñ‡¶§‡¶Æ ‡¶§‡¶æ‡¶∞‡¶æ‡¶¨‡¶ø‡¶π ‡¶∂‡ßã‡¶®‡¶æ ‡¶ï‡¶≤‡¶ø‡¶ú‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡¶æ‡¶®‡ßç‡¶§‡¶ø‡•§"]
};

module.exports.onLoad = ({ api }) => {
  const rule = new schedule.RecurrenceRule();
  rule.tz = 'Asia/Dhaka';
  rule.minute = 0; 

  schedule.scheduleJob(rule, async () => {
    try {
      const now = moment().tz('Asia/Dhaka');
      const time = now.format('hh:mm A');
      const date = now.format('DD MMM, YYYY');
      const hour = now.hour();

      // ‡ßß. ‡¶∞‡¶Æ‡¶ú‡¶æ‡¶® ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ì ‡ß®‡ß¶‡¶ü‡¶ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
      const ramadanStart = moment.tz("2026-02-19", "Asia/Dhaka");
      const passed = now.diff(ramadanStart, 'days') + 1;
      let ashra = passed <= 10 ? "‡¶∞‡¶π‡¶Æ‡¶§‡ßá‡¶∞ ‡¶¶‡¶∂‡¶ï" : (passed <= 20 ? "‡¶Æ‡¶æ‡¶ó‡¶´‡¶ø‡¶∞‡¶æ‡¶§‡ßá‡¶∞ ‡¶¶‡¶∂‡¶ï" : "‡¶®‡¶æ‡¶ú‡¶æ‡¶§‡ßá‡¶∞ ‡¶¶‡¶∂‡¶ï");
      
      const progressCount = Math.min(Math.max(Math.round(passed / 3), 0), 10);
      const progressBar = "‚ñì".repeat(progressCount) + "‚ñë".repeat(10 - progressCount);

      async function getTimes(city) {
        try {
          const res = await axios.get(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=Bangladesh&method=2`);
          const t = res.data.data.timings;
          const fmt = (tm) => moment(tm, "HH:mm").format("hh:mm A");
          return { f: fmt(t.Fajr), m: fmt(t.Maghrib), s: fmt(t.Sunrise), i: fmt(t.Isha), rawF: t.Fajr, rawM: t.Maghrib };
        } catch (e) { return null; }
      }

      const k = await getTimes("Kurigram");
      const s = await getTimes("Sirajganj");

      // ‚è≥ ‡¶∏‡ßá‡¶π‡¶∞‡¶ø ‡¶ì ‡¶á‡¶´‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶ø‡¶ñ‡ßÅ‡¶Å‡¶§ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶°‡¶æ‡¶â‡¶® (‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ ‡ßß ‡¶ì ‡ß®)
      let sehriLeft = "", iftarLeft = "";
      if (k) {
        const todaySehri = moment.tz(`${now.format('YYYY-MM-DD')} ${k.rawF}`, "YYYY-MM-DD HH:mm", "Asia/Dhaka");
        const todayIftar = moment.tz(`${now.format('YYYY-MM-DD')} ${k.rawM}`, "YYYY-MM-DD HH:mm", "Asia/Dhaka");
        
        const sDiff = moment.duration(todaySehri.diff(now));
        const iDiff = moment.duration(todayIftar.diff(now));

        sehriLeft = sDiff.asMinutes() > 0 ? `${Math.floor(sDiff.asHours())}h ${sDiff.minutes()}m ‡¶¨‡¶æ‡¶ï‡¶ø` : "‡¶∏‡¶Æ‡ßü ‡¶∂‡ßá‡¶∑";
        iftarLeft = iDiff.asMinutes() > 0 ? `${Math.floor(iDiff.asHours())}h ${iDiff.minutes()}m ‡¶¨‡¶æ‡¶ï‡¶ø` : "‡¶Ü‡¶≤‡¶π‡¶æ‡¶Æ‡¶¶‡ßÅ‡¶≤‡¶ø‡¶≤‡ßç‡¶≤‡¶æ‡¶π!";
      }

      const q = quotes[hour] || ["‡¶®‡ßá‡¶ï ‡¶Ü‡¶Æ‡¶≤‡ßá ‡¶¨‡ßç‡¶Ø‡¶∏‡ßç‡¶§ ‡¶•‡¶æ‡¶ï‡ßÅ‡¶®‡•§", "üìø ‡¶ú‡¶ø‡¶ï‡¶ø‡¶∞‡ßá ‡¶∏‡¶ú‡ßÄ‡¶¨ ‡¶•‡¶æ‡¶ï‡ßÅ‡¶®‡•§"];
      const ramUsage = (process.memoryUsage().heapUsed / 1024 / 1024).toFixed(2);
      const is5PM = hour === 17;

      // üíé ‡¶®‡¶§‡ßÅ‡¶® ‡ß®‡ß¶‡¶ü‡¶ø ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞‡¶∏ ‡¶á‡¶®‡¶°‡ßá‡¶ï‡ßç‡¶∏ (‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂):
      // ‡ßß. ‡¶∏‡ßá‡¶π‡¶∞‡¶ø ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶°‡¶æ‡¶â‡¶® ‡ß®. ‡¶á‡¶´‡¶§‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶°‡¶æ‡¶â‡¶® ‡ß©. ‡¶π‡¶ø‡¶ú‡¶∞‡¶ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡ß™. ‡¶Ü‡¶∂‡¶∞‡¶æ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡ß´. ‡¶Ø‡¶ø‡¶ï‡¶ø‡¶∞ ‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡ß¨. ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶∞‡¶Æ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡ß≠. ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡ßÆ. ‡¶á‡¶¨‡¶æ‡¶¶‡¶§ ‡¶ü‡¶ø‡¶™‡¶∏ ‡ßØ. ‡ß´‡¶ü‡¶æ ‡¶ó‡ßã‡¶≤‡ßç‡¶°‡ßá‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡ßß‡ß¶. ‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø‡ßã‡¶¶‡ßü ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡ßß‡ßß. ‡¶á‡¶∂‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡ßç‡¶ü ‡ßß‡ß®. ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶™‡ßç‡¶∞‡¶ó‡ßç‡¶∞‡ßá‡¶∏ ‡ßß‡ß©. ‡¶∂‡¶π‡¶∞ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶∏‡¶Æ‡ßü ‡ßß‡ß™. ‡¶∞‡¶ø‡ßü‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶°‡ßá‡¶ü ‡ßß‡ß´. ‡¶Ö‡¶ü‡ßã ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡ßß‡ß¨. ‡¶∞‡¶æ‡¶ú‡¶ï‡ßÄ‡ßü ‡¶¨‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡ßß‡ß≠. ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø ‡ßß‡ßÆ. ‡ßß‡ß® ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ‡¶ò‡ßú‡¶ø ‡ßß‡ßØ. ‡¶§‡¶∏‡¶¨‡¶ø‡¶π ‡¶ó‡¶æ‡¶á‡¶° ‡ß®‡ß¶. ‡¶™‡ßç‡¶∞‡¶≤‡ßá‡¶™ ‡¶®‡¶ï‡¶∂‡¶æ‡•§

      const header = is5PM ? "‚ú®üïåüåü ùó•ùó¢ùó¨ùóîùóü ùóúùóôùóßùóîùó• ùó®ùó£ùóóùóîùóßùóò üåüüïå‚ú®" : "üïåÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇüïå";
      const footer = is5PM ? "‚ú®üåüüåüüåüüåüüåüüåüüåüüåüüåüüåüüåüüåüüåüüåüüåüüåüüåü‚ú®" : "üïåÔπÅÔπÅÔπÅÔπÅÔπÅÔπÅÔπÅÔπÅÔπÅÔπÅÔπÅÔπÅÔπÅÔπÅÔπÅÔπÅÔπÅÔπÅÔπÅüïå";
      const dLine = "‚ùÉ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ùÉ";
      const dot = "‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà‚îà";

      const msg = `${header}
     üõ∞Ô∏è ùó†ùóîùó¶ùóßùóòùó• ùóïùóòùóüùóîùóü ùó®ùóüùóßùó•ùóî-ùó°ùóòùóß üõ∞Ô∏è
${footer}

 ‚åö ùóßùó∂ùó∫ùó≤  : ${time}  |  üìÖ ùóóùóÆùòÅùó≤ : ${date}
 üóìÔ∏è ùóóùóÆùòÜ   : ${now.format('dddd')}  |  üåô ùó£ùóµùóÆùòÄùó≤ : ${ashra}
 ${dLine}
 üïã ‡¶∞‡¶Æ‡¶ú‡¶æ‡¶®: ${passed}-‡¶§‡¶Æ ‡¶¶‡¶ø‡¶®
 üìä ‡¶™‡ßç‡¶∞‡¶ó‡ßç‡¶∞‡ßá‡¶∏: [${progressBar}] ${Math.round(passed * 3.3)}%
 ${dLine}
 üìú ùó†ùó≤ùòÄùòÄùóÆùó¥ùó≤  : ${q[0]}
 üìø ùóîùó∫ùóÆùóπ     : ${q[1]}
 ${dot}
 üìç ùóûùòÇùóøùó∂ùó¥ùóøùóÆùó∫ & ùó•ùóºùòÇùó∫ùóÆùóøùó∂:
 üí† ‡¶∏‡ßá‡¶π‡¶∞‡¶ø: ${k ? k.f : '--'}  ‚óà  üí† ‡¶á‡¶´‡¶§‡¶æ‡¶∞: ${k ? k.m : '--'}
 üìç ùó¶ùó∂ùóøùóÆùó∑ùó¥ùóÆùóªùó∑:
 üí† ‡¶∏‡ßá‡¶π‡¶∞‡¶ø: ${s ? s.f : '--'}  ‚óà  üí† ‡¶á‡¶´‡¶§‡¶æ‡¶∞: ${s ? s.m : '--'}
 ${dot}
 ‚è≥ ‡¶∏‡ßá‡¶π‡¶∞‡¶ø ‡¶¨‡¶æ‡¶ï‡¶ø: ${sehriLeft}
 ‚åõ ‡¶á‡¶´‡¶§‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ï‡¶ø: ${iftarLeft}
 ${dot}
 üí° ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ü‡¶ø‡¶™‡¶∏: ‡¶ì‡¶ú‡ßÅ ‡¶ï‡¶∞‡ßá ‡¶ò‡ßÅ‡¶Æ‡¶æ‡¶®‡ßã‡¶∞ ‡¶Ö‡¶≠‡ßç‡¶Ø‡¶æ‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
 ${dLine}
 üåÖ ‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø‡ßã‡¶¶‡ßü: ${k ? k.s : '--'}  |  üïå ‡¶á‡¶∂‡¶æ: ${k ? k.i : '--'}
 
 üöÄ ùó•ùóîùó†: ${ramUsage} MB  |  ‚úÖ ùó¶ùòÅùóÆùòÅùòÇùòÄ: ùó¶ùòÅùóÆùóØùóπùó≤
 ‚ú°Ô∏è‚ÉùüÖ∞üÖ≥üÖºüÖ∏üá≥‚îÄÕ¢Õ¢‡¶ö‡ßÉ‡¶æ‡¶Å‡¶¶‡ßá‡ßÉ‡¶Å‡¶∞‡ßÉ‡¶Å ‡¶™‡¶æ‡ßÉ‡¶Å‡¶π‡¶æ‡ßç‡¶Å‡ßú‡ßÉ‡¶Å‚ú°Ô∏è
${is5PM ? "üåüüïåüåüüïåüåüüïåüåüüïåüåüüïåüåüüïåüåüüïåüåüüïåüåüüïåüåü" : "üïåÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇÔπÇüïå"}`;

      const allThreads = global.data.allThreadID || [];
      for (const tID of allThreads) {
        api.sendMessage(msg, tID);
        await new Promise(r => setTimeout(r, 2000)); 
      }
    } catch (err) { console.error(err); }
  });
};

module.exports.run = () => {};
                                      
